<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000000">
<title>Video Grid + Fullscreen Scrollable</title>
<style>
body, html {
  margin:0; padding:0; background:#000; color:#fff;
  font-family: Arial, sans-serif; height:100%;
  overflow-y:auto; scroll-behavior: smooth;
}

.grid-container {
  display:grid; grid-template-columns: repeat(3, 1fr);
  gap:5px; padding:5px;
}

.video-card {
  position: relative; background:#111; border-radius:8px;
  overflow:hidden; height:200px; cursor:pointer;
}

.video-card video { width:100%; height:100%; object-fit:cover; }

.video-title {
  position:absolute; top:5px; left:5px; font-size:14px; font-weight:bold;
  color:#fff; text-shadow:0 0 5px #000; z-index:2;
}

.fullscreen-container {
  display: none;
  position: fixed;
  inset: 0;
  background: #000;
  overflow-y: scroll;
  scroll-snap-type: y mandatory; /* snap vertikal */
  z-index: 1000;
}

.fs-video-card {
  position: relative;
  width: 100%;
  min-height: 100vh;
  scroll-snap-align: start;
  background: #000;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

.fs-video-card video {
  max-height: 100vh;
  width: auto;
  object-fit: contain;
  border-radius: 8px;
}

.fs-title {
  position:absolute; bottom:40px; left:15px;
  font-size:20px; font-weight:bold; color:#fff;
  text-shadow:0 0 5px #000; z-index:2; pointer-events:none;
}

.fs-back-btn {
  position: absolute;
  top: 15px;
  left: 10px;
  z-index: 3;
  background: rgba(255, 255, 255, 0.15);
  border: none;
  color: #fff;
  padding: 10px 14px;
  border-radius: 999px;
  cursor: pointer;
  backdrop-filter: blur(6px);
}

.fs-pause-btn {
  position:absolute; inset:0; margin:auto; width:100px; height:100px;
  border:none; border-radius:50%; background:transparent;
  color:#fff; font-size:40px; cursor:pointer; z-index:3;
}

#folderBtn {
  position:fixed; top:10px; right:10px; font-size:24px;
  padding:5px 10px; cursor:pointer; background:rgba(255,255,255,0.1);
  border:none; color:#fff; border-radius:5px; z-index:1001;
}
</style>
</head>
<body>

<div class="grid-container" id="gridContainer"></div>
<button id="folderBtn">+</button>

<div class="fullscreen-container" id="fsContainer"></div>

<script>
const gridContainer = document.getElementById('gridContainer');
const folderBtn = document.getElementById('folderBtn');
const fsContainer = document.getElementById('fsContainer');

// Buka fullscreen + pushState
function openFullscreen(fsCard, fsVid){
  fsContainer.style.display='block';
  fsCard.scrollIntoView({behavior:'auto'});
  fsVid.play();
  history.pushState({fullscreen:true}, null, "");
}

// Tutup fullscreen + rollback history
function closeFullscreen(){
  fsContainer.style.display='none';
  if(history.state && history.state.fullscreen){
    history.back();
  }
}

// Intercept tombol back HP
window.addEventListener('popstate', function(e){
  if(fsContainer.style.display==='block'){
    closeFullscreen();
  }
});

folderBtn.addEventListener('click', async () => {
  try {
    const dirHandle = await window.showDirectoryPicker();
    gridContainer.innerHTML='';
    fsContainer.innerHTML='';

    for await (const entry of dirHandle.values()){
      if(entry.kind==='file' && entry.name.endsWith('.mp4')){
        const file = await entry.getFile();
        const url = URL.createObjectURL(file);

        const cleanName = entry.name.replace(/\.mp4$/i,'');

        // Grid card
        const card = document.createElement('div');
        card.className='video-card';
        const vid = document.createElement('video');
        vid.src=url; vid.loop=true; vid.muted=true;
        card.appendChild(vid);
        const title = document.createElement('div');
        title.className='video-title';
        title.textContent=cleanName;
        card.appendChild(title);
        gridContainer.appendChild(card);

        // Fullscreen card
        const fsCard = document.createElement('div');
        fsCard.className='fs-video-card';
        const fsVid = document.createElement('video');
        fsVid.src=url; fsVid.loop=true; fsVid.muted=false; fsVid.playsInline=true;
        fsCard.appendChild(fsVid);

        const fsTitle = document.createElement('div');
        fsTitle.className='fs-title';
        fsTitle.textContent=cleanName;
        fsCard.appendChild(fsTitle);

        // Tombol back ❌
        const backBtn = document.createElement('button');
        backBtn.className='fs-back-btn';
        backBtn.textContent='';
        backBtn.addEventListener('click', e=>{
          e.stopPropagation();
          closeFullscreen();
        });
        fsCard.appendChild(backBtn);

        // Tombol pause/play tengah
        const pauseBtn = document.createElement('button');
        pauseBtn.className='fs-pause-btn';
        pauseBtn.textContent='';
        pauseBtn.addEventListener('click', e=>{
          e.stopPropagation();
          if(fsVid.paused){
            fsVid.play();
            pauseBtn.textContent='';
          } else {
            fsVid.pause();
            pauseBtn.textContent='▶';
          }
        });
        fsCard.appendChild(pauseBtn);

        fsContainer.appendChild(fsCard);

        // Klik grid → fullscreen
        card.addEventListener('click', ()=>{
          openFullscreen(fsCard, fsVid);
        });
      }
    }

    // Autoplay scroll
    const fsVideos = document.querySelectorAll('.fs-video-card video');
    const observer = new IntersectionObserver(entries=>{
      entries.forEach(entry=>{
        if(entry.isIntersecting){
          entry.target.play();
        } else {
          entry.target.pause();
        }
      });
    }, {threshold:0.7});
    fsVideos.forEach(v=>observer.observe(v));

  } catch(e){
    console.log('Folder picker dibatalkan', e);
  }
});
</script>

</body>
</html>
