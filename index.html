<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Video Folder Grid</title>
<style>
body, html {
  margin:0; padding:0; background:#000; color:#fff;
  font-family: Arial, sans-serif; height:100%;
  overflow-y:auto; scroll-behavior: smooth;
}

#folderBar {
  display:flex; overflow-x:auto; white-space:nowrap;
  padding:10px; background:#111; border-bottom:1px solid #444;
}

.folder-btn {
  display:inline-block; padding:10px 20px; margin-right:5px;
  background:#222; border-radius:8px; cursor:pointer;
  flex:0 0 auto; white-space:nowrap;
}

.folder-btn.active {
  background:#007bff;
  color:#fff;
}

.grid-container {
  display:grid; grid-template-columns: repeat(3, 1fr);
  gap:5px; padding:5px;
}

.video-card {
  position: relative; background:#111; border-radius:8px;
  overflow:hidden; height:200px; cursor:pointer;
}

.video-card video { width:100%; height:100%; object-fit:cover; }

.video-title {
  position:absolute; top:5px; left:5px; font-size:14px; font-weight:bold;
  color:#fff; text-shadow:0 0 5px #000; z-index:2;
}

.fullscreen-container {
  display: none;
  position: fixed;
  inset: 0;
  background: #000;
  overflow-y: scroll;
  scroll-snap-type: y mandatory;
  z-index: 1000;
}

.fs-video-card {
  position: relative;
  width: 100%;
  min-height: 100vh;
  scroll-snap-align: start;
  background: #000;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

.fs-video-card video {
  max-height: 90vh;
  width: auto;
  object-fit: contain;
  border-radius: 8px;
}

.fs-title {
  position:absolute; bottom:80px; left:15px;
  font-size:20px; font-weight:bold; color:#fff;
  text-shadow:0 0 5px #000; z-index:2; pointer-events:none;
}

.fs-back-btn {
  position: absolute;
  top: 15px;
  left: 10px;
  z-index: 3;
  background: rgba(255, 255, 255, 0.15);
  border: none;
  color: #fff;
  padding: 10px 14px;
  border-radius: 999px;
  cursor: pointer;
  backdrop-filter: blur(6px);
}

.fs-pause-btn {
  position:absolute; inset:0; margin:auto; width:100px; height:100px;
  border:none; border-radius:50%; background:transparent;
  color:#fff; font-size:40px; cursor:pointer; z-index:3;
}

/* Tombol menu popup */
#menuBtn {
  position:fixed; top:10px; right:10px; font-size:20px;
  padding:3px 5px; cursor:pointer; background:rgba(255,255,255,0.1);
  border:none; color:#fff; border-radius:5px; z-index:1001;
}

/* Popup */
.popup {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.4);
  z-index: 1500;
}

.popup-content {
  background: #fff;
  width: 300px;
  margin: 15% auto;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.3);
  text-align: center;
  color:#000;
}

.popup-content h3 { margin-top: 0; }

.popup-content button {
  display: block;
  width: 100%;
  padding: 10px;
  margin: 10px 0;
  border: none;
  border-radius: 5px;
  background: #007bff;
  color: white;
  cursor: pointer;
  font-size: 16px;
}

.closeBtn { background: #dc3545; }

header {
  width: 100%;
  background: #333;
  color: #fff;
  padding: 30px;
  text-align: center;
  font-size: 18px;
}
</style>
</head>
<body>

<header>
  <button id="menuBtn">+</button>
</header>

<div id="folderBar"></div>
<div class="grid-container" id="gridContainer"></div>
<div class="fullscreen-container" id="fsContainer"></div>

<div id="popup" class="popup">
  <div class="popup-content">
    <h3>Pilih Aksi</h3>
    <button id="folderBtn">Masukin File</button>
    <button onclick="window.location='online'">Video Online</button>
    <button class="closeBtn" id="closePopup">Tutup</button>
  </div>
</div>

<script>
const folderBar = document.getElementById('folderBar');
const gridContainer = document.getElementById('gridContainer');
const fsContainer = document.getElementById('fsContainer');
const menuBtn = document.getElementById('menuBtn');
const popup = document.getElementById('popup');
const closePopup = document.getElementById('closePopup');

menuBtn.addEventListener('click', ()=> popup.style.display='block');
closePopup.addEventListener('click', ()=> popup.style.display='none');
window.addEventListener('click', (e)=> { if(e.target===popup) popup.style.display='none'; });

let folders = {}; // {folderName: [fileEntry,...]}
let allVideos = []; // array global untuk semua video

function registerVideo(vid){
  allVideos.push(vid);
  vid.addEventListener('play', ()=>{
    allVideos.forEach(v=>{
      if(v !== vid) v.pause();
    });
  });
}

// ---------------- Folder Picker ----------------
document.getElementById('folderBtn').addEventListener('click', async ()=>{
  popup.style.display='none';
  try{
    const dirHandle = await window.showDirectoryPicker();
    folders = {};
    gridContainer.innerHTML='';
    folderBar.innerHTML='';
    fsContainer.innerHTML='';

    for await (const entry of dirHandle.values()){
      if(entry.kind==='directory'){
        await loadFolderFiles(entry);
      } else if(entry.kind==='file' && entry.name.endsWith('.mp4')){
        if(!folders['Root']) folders['Root']=[];
        folders['Root'].push(entry);
      }
    }

    renderFolderButtons();
    if(Object.keys(folders).length>0) showFolder(Object.keys(folders)[0]);

  } catch(e){ console.log('Folder picker dibatalkan', e); }
});

// ---------------- Load Folder Files ----------------
async function loadFolderFiles(dirHandle){
  const files = [];
  for await(const entry of dirHandle.values()){
    if(entry.kind==='file' && entry.name.endsWith('.mp4')) files.push(entry);
  }
  if(files.length>0) folders[dirHandle.name] = files;
}

// ---------------- Render Folder Buttons ----------------
function renderFolderButtons(){
  folderBar.innerHTML='';
  Object.keys(folders).forEach((folderName, idx)=>{
    const btn = document.createElement('div');
    btn.className='folder-btn';
    if(idx===0) btn.classList.add('active');
    btn.textContent=folderName;
    btn.addEventListener('click', ()=> showFolder(folderName, btn));
    folderBar.appendChild(btn);
  });
}

// ---------------- Show Folder Videos ----------------
async function showFolder(folderName, btn=null){
  gridContainer.innerHTML='';
  if(btn){
    document.querySelectorAll('.folder-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
  }
  for(const entry of folders[folderName]){
    const file = await entry.getFile();
    const url = URL.createObjectURL(file);
    const cleanName = entry.name.replace(/\.mp4$/i,'');

    const card = document.createElement('div');
    card.className='video-card';
    const vid = document.createElement('video');
    vid.src=url; vid.loop=true; vid.muted=true;
    card.appendChild(vid);
    const title = document.createElement('div');
    title.className='video-title';
    title.textContent=cleanName;
    card.appendChild(title);
    gridContainer.appendChild(card);

    const fsCard = document.createElement('div');
    fsCard.className='fs-video-card';
    const fsVid = document.createElement('video');
    fsVid.src=url; fsVid.loop=true; fsVid.muted=false; fsVid.playsInline=true;
    fsCard.appendChild(fsVid);

    const fsTitle = document.createElement('div');
    fsTitle.className='fs-title';
    fsTitle.textContent=cleanName;
    fsCard.appendChild(fsTitle);

    const backBtn = document.createElement('button');
    backBtn.className='fs-back-btn';
    backBtn.addEventListener('click', e=>{ e.stopPropagation(); closeFullscreen(); });
    fsCard.appendChild(backBtn);

    const pauseBtn = document.createElement('button');
pauseBtn.className = 'fs-pause-btn';

pauseBtn.addEventListener('click', e => {
  e.stopPropagation();
  if (fsVid.paused) {
    fsVid.play();
    pauseBtn.textContent = ''; // kosongkan icon saat play
  } else {
    fsVid.pause();
    pauseBtn.textContent = ' â–¶'; // tampilkan pause saat pause
  }
    });
    fsCard.appendChild(pauseBtn);

    fsContainer.appendChild(fsCard);

    // register semua video untuk auto-pause
    registerVideo(vid);
    registerVideo(fsVid);

    card.addEventListener('click', ()=>openFullscreen(fsCard, fsVid));
  }

  const fsVideos = document.querySelectorAll('.fs-video-card video');
  const observer = new IntersectionObserver(entries=>{
    entries.forEach(entry=>{
      if(entry.isIntersecting) entry.target.play();
      else entry.target.pause();
    });
  }, {threshold:0.7});
  fsVideos.forEach(v=>observer.observe(v));
}

// ---------------- Fullscreen ----------------
function openFullscreen(fsCard, fsVid){
  fsContainer.style.display='block';
  fsCard.scrollIntoView({behavior:'auto'});
  fsVid.play();
  history.pushState({fullscreen:true}, null, "");
}
function closeFullscreen(){
  fsContainer.style.display='none';
  if(history.state && history.state.fullscreen) history.back();
}
window.addEventListener('popstate', function(e){ if(fsContainer.style.display==='block') closeFullscreen(); });

</script>
</body>
</html>
