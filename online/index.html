<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Video Grid Persist + Firebase</title>
<style>
body{margin:0;font-family:sans-serif;background:#111;color:#fff;}
header{background:#222;padding:10px;display:flex;justify-content:flex-end;}
header button{padding:8px 12px;background:#0f0;color:#000;border:none;cursor:pointer;}
#videosGrid{display:grid;grid-template-columns:repeat(2,1fr);gap:15px;padding:15px;}
.video-container{position:relative;border:1px solid #444;height:180px;display:flex;justify-content:center;align-items:center;background:#000;cursor:pointer;overflow:hidden;}
.video-container button.delete-btn{position:absolute;top:5px;right:5px;padding:2px 5px;background:red;color:#fff;border:none;cursor:pointer;z-index:10;font-size:12px;}
#sidebar{position:fixed;top:0;right:-320px;width:300px;height:100%;background:#222;padding:15px;box-sizing:border-box;transition:0.3s;display:flex;flex-direction:column;z-index:20;}
#sidebar textarea{width:100%;height:80px;margin-bottom:10px;padding:5px;}
#sidebar button{padding:8px;background:#0f0;color:#000;border:none;cursor:pointer;}
#overlayVideo{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:#000;justify-content:center;align-items:center;z-index:50;}
#overlayVideo video,#overlayVideo iframe{width:90%;height:80%;}
#overlayVideo button{position:absolute;top:10px;right:10px;background:#0f0;color:#000;border:none;padding:5px 10px;cursor:pointer;font-size:16px;z-index:60;}
</style>
</head>
<body>

<header>
  <button id="toggleSidebar">Tambah Video</button>
</header>

<div id="videosGrid"></div>

<div id="sidebar">
  <textarea id="videoLinks" placeholder="Masukkan link video/embed, tiap baris 1 link"></textarea>
  <div style="display:flex; gap:5px; margin-bottom:5px;">
    <button id="addVideos" style="flex:1;">OK</button>
    <button id="closeSidebar" style="flex:1;">Tutup</button>
  </div>
</div>

<div id="overlayVideo">
  <button id="closeOverlay">X</button>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
// --- Firebase Config ---
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "SENDER_ID",
  appId: "APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// --- DOM Elements ---
const grid = document.getElementById("videosGrid");
const sidebar = document.getElementById("sidebar");
const toggleSidebarBtn = document.getElementById("toggleSidebar");
const closeSidebarBtn = document.getElementById("closeSidebar");
const addBtn = document.getElementById("addVideos");
const textarea = document.getElementById("videoLinks");
const overlay = document.getElementById("overlayVideo");
const closeOverlayBtn = document.getElementById("closeOverlay");

let videoURLs = [];

// --- Sidebar toggle ---
toggleSidebarBtn.onclick = () => { sidebar.style.right="0"; };
closeSidebarBtn.onclick = () => { sidebar.style.right="-320px"; };

// --- Overlay ---
closeOverlayBtn.onclick = () => {
  overlay.style.display="none";
  overlay.innerHTML = '<button id="closeOverlay">X</button>';
};

// --- Generate embed ---
function generateEmbed(url){
  let embed;
  const ytMatch = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([\w-]+)/);
  if(ytMatch){
    embed = document.createElement("iframe");
    embed.src = `https://www.youtube.com/embed/${ytMatch[1]}`;
    embed.allowFullscreen = true;
  } else if(url.includes("drive.google.com")){
    let fileId = url.match(/\/d\/(.*?)\//)?.[1] || url.match(/id=(.*)/)?.[1];
    if(fileId){
      embed = document.createElement("iframe");
      embed.src = `https://drive.google.com/file/d/${fileId}/preview`;
      embed.allowFullscreen = true;
    } else {
      embed = document.createElement("a");
      embed.href = url;
      embed.textContent = "Buka video Drive";
      embed.target = "_blank";
    }
  } else if(url.includes("vimeo.com")){
    let id = url.split("/").pop();
    embed = document.createElement("iframe");
    embed.src = `https://player.vimeo.com/video/${id}`;
    embed.allowFullscreen = true;
  } else if(url.match(/\.(mp4|m3u8|webm|ogg)$/i)){
    embed = document.createElement("video");
    embed.src = url;
    embed.controls = true;
  } else {
    embed = document.createElement("a");
    embed.href = url;
    embed.textContent = url;
    embed.target = "_blank";
  }
  embed.style.width = "100%";
  embed.style.height = "100%";
  return embed;
}

// --- Add video to grid & optionally save to Firestore ---
function addVideoToGrid(url, save){
  if(videoURLs.includes(url)) return;

  const container = document.createElement("div");
  container.className = "video-container";

  // Delete button
  const delBtn = document.createElement("button");
  delBtn.textContent = "X";
  delBtn.className = "delete-btn";
  delBtn.onclick = (e)=>{
    e.stopPropagation();
    grid.removeChild(container);
    videoURLs = videoURLs.filter(u=>u!==url);
    db.collection("videos").doc(url).delete();
  };
  container.appendChild(delBtn);

  container.appendChild(generateEmbed(url));

  container.onclick = () => {
    overlay.style.display="flex";
    overlay.innerHTML = '<button id="closeOverlay">X</button>';
    overlay.appendChild(generateEmbed(url));
    document.getElementById("closeOverlay").onclick = closeOverlayBtn.onclick;
  };

  grid.appendChild(container);

  if(save){
    videoURLs.push(url);
    db.collection("videos").doc(url).set({url});
  }
}

// --- Add videos from textarea ---
addBtn.onclick = () => {
  const links = textarea.value.split("\n").map(l=>l.trim()).filter(l=>l);
  links.forEach(url => addVideoToGrid(url,true));
  textarea.value="";
  sidebar.style.right="-320px";
};

// --- Load videos from Firestore ---
db.collection("videos").get().then(snapshot => {
  snapshot.forEach(doc => {
    addVideoToGrid(doc.data().url,false);
    videoURLs.push(doc.data().url);
  });
});
</script>
</body>
</html>
